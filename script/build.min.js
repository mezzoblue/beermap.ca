/*! beermap.ca 2014-11-02 */
function hasClass(a,b){return new RegExp(" "+b+" ").test(" "+a.className+" ")}function toggleClass(a,b){var c=" "+a.className.replace(/[\t\r\n]/g," ")+" ";if(hasClass(a,b)){for(;c.indexOf(" "+b+" ")>=0;)c=c.replace(" "+b+" "," ");a.className=c.replace(/^\s+|\s+$/g,"")}else a.className+=" "+b}function removeClass(a,b){var c=" "+a.className.replace(/[\t\r\n]/g," ")+" ";if(hasClass(a,b)){for(;c.indexOf(" "+b+" ")>=0;)c=c.replace(" "+b+" "," ");a.className=c.replace(/^\s+|\s+$/g,"")}}function addHTML(a,b,c){a.insertAdjacentHTML(c,b)}function setClass(a,b){a.className=b}function readJSON(a){var b=new XMLHttpRequest;return b.open("GET",a,!1),b.send(null),200==b.status?b.responseText:void 0}function IconClass(){this.brewery="",this.brewpub="",this.nano="",this.other="",this.unknown=""}function setMediumIcons(){var a=L.Icon.extend({options:{iconSize:new L.Point(23,23),iconAnchor:new L.Point(11,11),popupAnchor:new L.Point(0,-11)}});return mapIcon=new IconClass,mapIcon.brewery=new a({iconUrl:"images/brewery.png"}),mapIcon.brewpub=new a({iconUrl:"images/brewpub.png"}),mapIcon.nano=new a({iconUrl:"images/nano.png"}),mapIcon.other=new a({iconUrl:"images/other.png"}),mapIcon.unknown=new a({iconUrl:"images/unknown.png"}),mapIcon}function addMarkers(a){{var b=a;b.feature}b.bindPopup(popupContent,{closeButton:!0,minWidth:240})}function createLayer(a,b,c,d){var e=L.geoJson(a,{style:function(a){return{color:a.properties.color}},onEachFeature:function(a,b){var c=b;"Brewery"==a.properties.Type?c.setIcon(mapIcons.brewery):"Brewpub"==a.properties.Type?c.setIcon(mapIcons.brewpub):"Nanobrewery"==a.properties.Type?c.setIcon(mapIcons.nano):"Unknown"==a.properties.Type?c.setIcon(mapIcons.unknown):("Brewpub Chain"==a.properties.Type||"Contract Brewer"==a.properties.Type||"Gypsy Brewer"==a.properties.Type||"Training Brewery"==a.properties.Type)&&c.setIcon(mapIcons.other);var d='<div class="map-popup">';d+=a.properties.URL?'<h2><a class="main-link" href="'+a.properties.URL+'">'+a.properties.Name+"</a></h2>":"<h2>"+a.properties.Name+"</h2>",d+="   <ul>",a.properties.AKA&&(d+='   	<li class="aka">aka '+a.properties.AKA+"</li>"),d+="   	<li>"+a.properties.City+", "+a.properties.Province+"</li>",a.properties.Note&&(d+='      <li class="note">'+a.properties.Note+"</li>"),d+='      <li class="extra">',a.properties.Twitter&&(d+='<a class="twitter" href="'+a.properties.Twitter+'">T</a>'),a.properties.Facebook&&(d+='<a class="fb" href="'+a.properties.Facebook+'">F</a>'),a.properties.Type&&"Unknown"!=a.properties.Type&&(d+='<span class="type">'+a.properties.Type+"</span>"),d+="      </li>",a.properties.Closed&&(d+='      <li class="closed">Closed: '+a.properties.Closed+"</li>"),d+="   </ul>",d+="</div>",c.bindPopup(d,{closeButton:!0,minWidth:240})}});d&&e.addTo(map);var f=document.createElement("a");f.href="#",d&&(f.className="active"),f.innerHTML=b+" ("+a.features.length+")",f.onclick=function(a){a.preventDefault(),a.stopPropagation();var b=toggleLayer(map,e);setClass(this,b)};var g=document.createElement("li");g.className="nav-item",g.appendChild(f),c.appendChild(g)}function toggleLayer(a,b){var c;return a.hasLayer(b)?(a.removeLayer(b),c=""):(a.addLayer(b),c="active"),c}function disableScrolling(){document.addEventListener("touchmove",function(a){a.preventDefault()},!1)}function addCollapse(a){var b=document.getElementById(a);addHTML(b,"<div class='nav-collapse' id='nav-collapse'></div>","beforebegin"),document.getElementById("nav-collapse").onclick=function(){siteNav=document.getElementById(a),mapContainer=document.getElementById("map"),toggleClass(mapContainer,"collapsed"),toggleClass(siteNav,"collapsed"),toggleClass(this,"collapsed")}}L.mapbox.accessToken="pk.eyJ1IjoibWV6em9ibHVlIiwiYSI6IlpvbExZUncifQ.FQxaqWQaK6VcOg05GUHIPg";var map=L.mapbox.map("map","mezzoblue.map-0311vf6d").setView([46,-107.215],4),mapIcons=setMediumIcons(),abSrc=JSON.parse(readJSON("../canadian-craft-breweries/alberta.geojson")),bcSrc=JSON.parse(readJSON("../canadian-craft-breweries/bc.geojson")),mbSrc=JSON.parse(readJSON("../canadian-craft-breweries/manitoba.geojson")),nbSrc=JSON.parse(readJSON("../canadian-craft-breweries/newbrunswick.geojson")),nlSrc=JSON.parse(readJSON("../canadian-craft-breweries/newfoundlandlabrador.geojson")),nsSrc=JSON.parse(readJSON("../canadian-craft-breweries/novascotia.geojson")),onSrc=JSON.parse(readJSON("../canadian-craft-breweries/ontario.geojson")),peiSrc=JSON.parse(readJSON("../canadian-craft-breweries/pei.geojson")),qcSrc=JSON.parse(readJSON("../canadian-craft-breweries/quebec.geojson")),skSrc=JSON.parse(readJSON("../canadian-craft-breweries/saskatchewan.geojson")),yukonSrc=JSON.parse(readJSON("../canadian-craft-breweries/yukon.geojson")),rumourSrc=JSON.parse(readJSON("../canadian-craft-breweries/upcoming-rumoured.geojson")),closedSrc=JSON.parse(readJSON("../canadian-craft-breweries/defunct.geojson")),nav=document.getElementById("nav");createLayer(abSrc,"Alberta",nav,!0),createLayer(bcSrc,"BC",nav,!0),createLayer(mbSrc,"Manitoba",nav,!0),createLayer(nbSrc,"New Brunswick",nav,!0),createLayer(nlSrc,"Newfoundland &amp; Labrador",nav,!0),createLayer(nsSrc,"Nova Scotia",nav,!0),createLayer(onSrc,"Ontario",nav,!0),createLayer(peiSrc,"PEI",nav,!0),createLayer(qcSrc,"Quebec",nav,!0),createLayer(skSrc,"Saskatchewan",nav,!0),createLayer(yukonSrc,"Yukon",nav,!0),createLayer(rumourSrc,"Rumours",nav,!1),createLayer(closedSrc,"Closed",nav,!1),disableScrolling(),addCollapse("site-header");